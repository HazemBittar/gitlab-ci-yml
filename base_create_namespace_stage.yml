#

.base_create_namespace_stage: &base_create_namespace_stage
  extends: .base_docker_kube_image_stage
  stage: "Registration"
  environment:
    name: factory-dev
  dependencies: []
  script:
    # Skip the job if the namespace exists
    - "[[ $(kubectl get namespace ${K8S_NAMESPACE}) ]] && exit ${CI_JOB_SKIP_EXIT_CODE:-0}"
    #
    - kubectl create namespace ${K8S_NAMESPACE}
    - kubectl annotate namespace ${K8S_NAMESPACE} field.cattle.io/projectId=${RANCHER_PROJECT_ID}
    #
    # Fake rancher namespace creation
    - kubectl annotate namespace ${K8S_NAMESPACE} field.cattle.io/containerDefaultResourceLimit='{}'
    - kubectl annotate namespace ${K8S_NAMESPACE} field.cattle.io/creatorId=gitlab
    # Link the namespace to a git branch
    - kubectl annotate namespace ${K8S_NAMESPACE} git/branch=${CI_COMMIT_REF_NAME}
